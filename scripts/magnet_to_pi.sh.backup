#!/bin/bash
# Send magnet links straight through to transmission
# gconftool-2 -t string -s /desktop/gnome/url-handlers/magnet/command "/path/to/your/script/from/above/magnetLinkTransfer.sh %s"
# gconftool-2 -s /desktop/gnome/url-handlers/magnet/needs_terminal false -t bool
# gconftool-2 -t bool -s /desktop/gnome/url-handlers/magnet/enabled true
test -z $1 && echo "need magnet link!
$0 <magnet link>" && exit -1

HOST=192.168.0.102
PORT=9091
USER=transmission
# NOTE: I had issues using passwords with semicolons (;) in them,
#       you might want to stay away from them
PASS=Miqis147

LINK="$1"

# set true if you want every torrent to be paused initially
PAUSED="true"
SESSID=$(curl --silent --anyauth --user $USER:$PASS "http://$HOST:$PORT/transmission/rpc" | sed 's/.*<code>//g;s/<\/code>.*//g')
curl --silent --anyauth --user $USER:$PASS --header "$SESSID" "http://$HOST:$PORT/transmission/rpc" -d "{\"method\":\"torrent-add\",\"arguments\":{\"paused\":${PAUSED},\"filename\":\"${LINK}\"}}"

